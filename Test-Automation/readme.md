# Racket-QA Automated-Test Scheduler

Racket QA Test Scheduler provides the functionality to schedule an execution of RackUnit source files at a specified time and store its output or send it to a specified mailing list. It is capable of executing RackUnit test suite files generated by <a href="https://github.com/oplS15projects/Racket-QA/blob/master/Bottle-Racket/README.md" target="_blank">**Bottle-Racket**</a> using its APIs, as well as any other Racket source files that can be run with the Racket executable.


### How to use the Scheduler

Here is a quick demo video on how to use the test scheduler.

<a href="http://www.youtube.com/watch?feature=player_embedded&v=JqngnONV9ks
" target="_blank"><img src="http://img.youtube.com/vi/JqngnONV9ks/0.jpg"
alt="Test Scheduler Demo" width="240" height="180" border="10" /></a>


In order to start the scheduler, click `Test Scheduler` icon button from the main UI.

![scheduler_launcher](images/documentation/ui_launcher.png)



On the left side of the scheduler window are two list boxes containing active and inactive `autotest` items. An autotest is a kind of a container the scheduler uses to identify a group of racket source files to execute together. From your perspective, it is simply a collection of racket source files to run at a certain time. An `inactive` autotest item allows you to temporarily stop a periodic autotest item from executing.

The autotest lists will be empty when you first launch the scheduler UI. You can click the `Create A New Autotest` button on the top right corner to schedule a new autotest.

![UI_empty](images/documentation/ui_empty.png)



Clicking the `Create A New Autotest` button will enable the input fields on the right side of the window so you can fill them out. Some of the input fields will be disabled based on whether you have selected `one-time` or `repeat` radio button. To schedule a one-time test, you need to provide the time and date to run the test. For repeating test, you need to provide which days of week to run the test instead of a single date.

![UI_create](images/documentation/ui_create.png)



Here are the list of all the information the scheduler needs from you to schedule an autotest.
* Name of the autotest item
* Files to execute - one or more files can be associated with an autotest item
* Time of day to execute the test
* Whether to execute it once or repeatedly
* The date of execution for one-time test
* Days of week for a repeated test
* Whether to notify the result via email
* Mailing list to be used for e-mail notification

In order to select the files you want the scheduler to execute, you can use the icon buttons which will open the file-selection dialog.

![UI_create](images/documentation/ui_files.png)



Once you have finished filling out the form, you can click either the `Schedule and Activate` or `Schedule as Inactive` button. Clicking the `Schedule as Inactive` button will save all information you entered but will not actually cause the autotest to run when it comes due. This autotest item will stay in the `Inactive tests` list so you can activate it any time later.

![UI_create](images/documentation/ui_create_activate.png)



You can modify the configuration of the autotest items you have created simply by changing the values you want and clicking `Save Changes` button.

![UI_browse](images/documentation/ui_browse.png)



If you want the results to be emailed after the execution of an auto-test, you can check the `Notify?` check box and configure a mailing list by clicking `Select Mailing List...` button. After the execution of each file, an email containing the test result will be sent out to the addresses in the mailing list you have chosen.

![UI_email](images/documentation/ui_email.png)



If you want to activate, deactivate or delete an autotest item you have created, you can use the `Autotest Actions` drop-down menu below the test list boxes. You can also duplicate an autotest item if you want to execute the same files multiple times a day. You can do this by duplicating an autotest item and make it run at a different time. It is also ok to make them run at the same time if for any reason you wish to do so. They will run one right after the other in this case.

![UI_actions](images/documentation/ui_actions.png)



When an active autotest comes due, the Racket source files associated with it will be executed by <a href="https://github.com/oplS15projects/Racket-QA/blob/master/Bottle-Racket/README.md" target="_blank">**Bottle-Racket**</a> APIs. This will execute the files the same way you would do it manually with Bottle-Racket, and generate the exact same result. During the execution, the scheduler will output to the Dr.Racket console which files are currently being executed.

![UI_run_test](images/documentation/ui_run_test.png)



The result file will also be placed where Bottle-Racket would normally place it - same directory as the executed test suite file.

![result_file_bottleracket](images/documentation/result_file_bottleracket.png)

Here is an example result from executing a test suite file formatted to Bottle-Racket standard.
```
Starting Test Suite 'ps1'
--------------------
ps1 > (comb 3 2)
(comb 3 2)
FAILURE
name:       check-equal?
location:   temp-test-run.rkt:24:26
actual:     1
expected:   3
Check failure
--------------------
--------------------
ps1 > (comb 4 2)
(comb 4 2)
FAILURE
name:       check-equal?
location:   temp-test-run.rkt:25:26
actual:     1
expected:   6
Check failure
--------------------
--------------------
ps1 > (comb 10 2)
(comb 10 2)
FAILURE
name:       check-equal?
location:   temp-test-run.rkt:26:27
actual:     1
expected:   45
Check failure
--------------------
--------------------
ps1 > (comb 93 37)
(comb 93 37)
FAILURE
name:       check-equal?
location:   temp-test-run.rkt:27:28
actual:     1
expected:   118206769052646517220135262
Check failure
--------------------
Finished Test Suite 'ps1'
26 success(es) 4 failure(s) 0 error(s) 30 test(s) run
'(4)

```


Although Bottle-Racket's test suite file format is easy to follow, you may want the scheduler to execute some RackUnit test files that are not formatted for the Bottle-Racket. If the scheduler encounters a racket source file that it does not recognize as Bottle-Racket test-suite format, it will execute it directly with the `racket` command. This will work same as you would execute the file in terminal by typing `racket.exe \<yourfile.rkt\>`. The result collected this way will be the same as what you would see in the terminal window when you execute the file manually. The result will be saved in `Racket-QA Auto-Test Result` directory created under where the executed source file is located.

![result_file_non_bottleracket](images/documentation/result_file.png)

Here is an example result from executing a RackUnit source file that is not Bottle-Racket standard.
```
################################################################################
# Auto-test Name: Scheduler test with non-area file
# RKT File Executed: D:\Data\online\Development\Git Clone\Racket-QA\Test-Automation\testing\test-file1.rkt
# Executed on: Friday, April 24th, 2015 4:29:02pm
################################################################################

--------------------
FAILURE
actual:     4
expected:   2
name:       check-equal?
location:   (#<path:D:\Data\online\Development\Git Clone\Racket-QA\Test-Automation\testing\test-file1.rkt> 7 0 102 51)
expression: (check-equal? (my-* 1 2) 2)
message:    "Simple multiplication"

Check failure
--------------------
--------------------
FAILURE
actual:     8
expected:   4
name:       check-equal?
location:   (#<path:D:\Data\online\Development\Git Clone\Racket-QA\Test-Automation\testing\test-file1.rkt> 8 0 154 51)
expression: (check-equal? (my-* 1 4) 4)
message:    "Simple multiplication"

Check failure
--------------------


```

Once all the files in an autotest have been executed, the autotest is finished. A repeating autotest will execute again at the same time on the next due day. One-time autotest will not execute again, although it will stay in the scheduler UI so you can run it again any time you wish by moving its due time forward.



### Implementation

Here are the files that comprise the test scheduler.
* `autotest.rkt` implements an autotest object that contains all the information necessary to execute a set of racket source files without user intervention, such as the execution time, list of files to execute, whether to notify the results through email, and so on.
* `scheduler.rkt` implements threads to keep track of current time and calls Bottle-Racket APIs to execute autotests as they come due.
* `bg-process.rkt` starts the timer and runner threads defined in `scheduler.rkt`.
* `scheduler-ui.rkt` implements the user interface to schedule an automated test. Information gathered through the UI is saved as an autotest object implemented in the `autotest.rkt`.
* `input-validation.rkt` provides procedures to validate user entries in the scheduler UI.
* `calendar.rkt` provides utility procedures for the autotest object to calculate the correct due time when requested by the scheduler threads.


### Limitation
* The repeated test functionality currently supports automatic execution of a same test as often as daily. It does not support running the same test automatically more than once a day. However, users can easily work around this by creating more than one autotest items with same files and making each autotest run at different hours. The UI provides 'duplicate test' option to make this easy.
* The scheduled tests will run automatically only when bg-process.rkt file stays loaded in the Dr.Racket framework. Once Dr.Racket closes, scheduler threads are terminated and the scheduled tests will not run automatically anymore. The scheduler window can be closed as long as Dr.Racket stays open. Enabling the scheduler threads to stay active without the presence of Dr.Racket requires the scheduler component to be a standalone executable, and may be implemented some time in the future.


<!-- Links -->
[Bottle-Racket Document]: https://github.com/oplS15projects/Racket-QA/blob/master/Bottle-Racket/README.md
